<!DOCTYPE html>
<html xml:lang="EN" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>Hidden Object Poster - Plan:g</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="icon" type="image/png" href="../../favicon.png" />
    <script src="../../openseadragon/openseadragon.min.js"></script>
    <script src="../../detect-browser.js"></script>
    <script type="text/javascript">
      var info = getBrowser();
      if (
        info.browser === "Microsoft Edge" ||
        info.browser === "Safari" ||
        info.browser === "Internet Explorer"
      ) {
        window.location = "../../index_ie.html";
      }
    </script>
    <style>
      @font-face {
        font-family: "circular";
        src: url("../../src/lineto-circular-book.woff") format("woff");
        font-weight: normal;
      }
      * { margin: 0; padding: 0; }
      html, body { height: 100%; }
      body { position: relative; overflow: hidden; background:#f3f3f3; }
      .logo-container {
        position:absolute; z-index:1000; top:25px; left:25px;
        opacity:0; display:none; transition:opacity 900ms, display 900ms;
      }
      .logo { width:250px; padding-bottom:30px; }
      .signet { width:100px; }
      #myContainer {
        width:100%; height:100vh; background:#769b60; position:absolute; left:10vw; z-index:500;
        clip-path:circle(20vw at center); transition:left 900ms, clip-path 900ms;
      }
      #myContainer:hover { clip-path:circle(100vw at center); left:0; }
      #myContainer:hover ~ .logo-container { opacity:1; display:block; }
      .welcome { position:absolute; z-index:250; top:51px; left:22px; width:70%; }
      .impressum { position:absolute; bottom:20px; left:22px; font-family:"circular"; z-index:260; font-size:18px; line-height:1.5; }
      .welcomeMessage { font-family:"circular"; margin-top:20px; }
      .link { text-decoration:none; }
      .text-link { color:#789f40; }
      .flexcta { width:60%; padding-top:60px; }
      .cta {
        font-family:"circular"; max-width:230px; background:#789f40; padding:15px; color:#fff; text-decoration:none;
        display:flex; align-items:center; justify-content:center; text-transform:uppercase; font-weight:bold; font-size:18px;
        transition:background-color 600ms; margin:20px 0 0 0;
      }
      .cta:hover { background:#870184; }
      .language { display:flex; width:80px; height:50px; justify-content:space-between; font-size:14px; }
      .flag-container { text-align:center; margin:10px 0; }
      .flag { width:30px; height:22px; background-size:cover; margin:10px auto; }
      .flag.en { background-image:url("https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/flags/4x3/gb.svg"); }
      .flag.de { background-image:url("https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/flags/4x3/at.svg"); }
      .hotspot-overlay { width:10px; height:10px; background-size:cover; background-repeat:no-repeat; cursor:pointer; }
    </style>

    <!-- Matomo -->
    <script type="text/javascript">
      var _paq = window._paq || [];
      _paq.push(["trackPageView"]);
      _paq.push(["enableLinkTracking"]);
      (function () {
        var u = "https://www.plan-g.at/sub/piwik/";
        _paq.push(["setTrackerUrl", u + "piwik.php"]);
        _paq.push(["setSiteId", "4"]);
        var d=document,g=d.createElement("script"),s=d.getElementsByTagName("script")[0];
        g.type="text/javascript"; g.async=true; g.defer=true; g.src=u+"piwik.js";
        s.parentNode.insertBefore(g,s);
      })();
    </script>
    <!-- End Matomo Code -->
  </head>
  <body>
    <div id="myContainer"></div>

    <script>
      // This HTML lives in Assets/en/
      const OSD_PREFIX = "../../openseadragon/images/";
      const BUTTON_ICON = "../../Assets/Skins/button-wim.png";     // <-- fixed
      const POPUP_BASE  = "../../Assets/popups-en/";               // <-- fixed

      var viewer = OpenSeadragon({
        id: "myContainer",
        prefixUrl: OSD_PREFIX,
        tileSources: {
          type: "image",
          width: 5787,
          height: 7722,
          url: "../../img/wimmelbildfinal.jpg",
          minLevel: 0,
          maxLevel: 5,
          buildPyramid: true
        },
        showNavigator: true,
        navigatorPosition: "TOP_RIGHT",
        defaultZoomLevel: 0,
        showNavigationControl: true
      });

      function loadHotspots(xmlFile) {
        fetch(xmlFile)
          .then(r => r.text())
          .then(str => new DOMParser().parseFromString(str, "text/xml"))
          .then(xml => {
            let hs = xml.getElementsByTagName("HOTSPOT");
            for (let i = 0; i < hs.length; i++) {
              let x = parseFloat(hs[i].getAttribute("X"));
              let y = parseFloat(hs[i].getAttribute("Y"));
              let id = hs[i].getAttribute("ID");
              let popupImage = hs[i].getAttribute("POPUP") || "";

              // Force English popup path
              if (popupImage.indexOf("/") === -1) {
                if (!popupImage.startsWith("popup_en_")) {
                  popupImage = popupImage.replace(/^popup_/, "popup_en_");
                }
                popupImage = POPUP_BASE + popupImage;
              } else {
                popupImage = popupImage
                  .replace("/popups/", "/popups-en/")
                  .replace(/\/popup_/, "/popup_en_");
                if (!popupImage.startsWith("../")) {
                  popupImage = "../../" + popupImage.replace(/^\.?\/*/, "");
                }
              }

              addOverlay(x, y, id, BUTTON_ICON, popupImage);
            }
          })
          .catch(err => console.error("Error loading XML:", err));
      }

      function addOverlay(x, y, id, icon, popupImage) {
        const normalizedX = (x * (5787 / 14344)) / 5787;
        const normalizedY = (y * (7722 / 19140)) / 7722 * 1.3348;

        const overlay = document.createElement("div");
        overlay.className = "hotspot-overlay";
        overlay.style.backgroundImage = `url(${icon})`;

        overlay.onmouseover = () => togglePopup(id, normalizedX, normalizedY, popupImage);
        overlay.onmouseout  = () => togglePopup(id, normalizedX, normalizedY, popupImage);

        viewer.addOverlay({
          element: overlay,
          location: new OpenSeadragon.Point(normalizedX, normalizedY),
          placement: OpenSeadragon.OverlayPlacement.CENTER
        });
      }

      function togglePopup(id, x, y, popupImage) {
        const existing = document.getElementById(`popup-${id}`);
        if (existing) {
          existing.remove();
          return;
        }
        const popup = document.createElement("div");
        popup.className = "popup";
        popup.id = `popup-${id}`;
        popup.innerHTML = `<img src="${popupImage}" width="400" alt="Info">`;

        viewer.addOverlay({
          element: popup,
          location: new OpenSeadragon.Point(x, y),
          placement: OpenSeadragon.OverlayPlacement.BOTTOM
        });
      }

      // XML liegt im Root unter /src/
      loadHotspots("../../src/hotspots.xml");
    </script>

    <div class="logo-container">
      <a href="https://plan-g.at/ueber-uns" target="_blank">
        <img src="../../img/signet_bunt.png" class="signet" alt="Plan:g Signet" />
      </a>
    </div>

    <div class="welcome">
      <a href="https://plan-g.at/ueber-uns" target="_blank">
        <img src="../../img/logo.png" class="logo" alt="Plan:g Logo" />
      </a>
      <h1 class="welcomeMessage">
        The world is quite small,<br />
        health is quite complex:<br />
        have fun exploring.
      </h1>
      <div class="flexcta">
        <a href="https://plan-g.at/fachthemen/medizin-und-eza" target="_blank" class="link">
          <div class="cta">This Poster</div>
        </a>
        <a href="https://plan-g.at/projekte/alle-projekte" target="_blank" class="link">
          <div class="cta">Our Work</div>
        </a>
        <a href="https://plan-g.at/news-events/informiert-bleiben" target="_blank" class="link">
          <div class="cta">Stay Informed</div>
        </a>
      </div>
    </div>

    <div class="impressum">
      <div class="language">
        <div class="flag-container">
          <a href="https://weltgesundheit.org" class="text-link">
            <div class="flag de" title="Deutsch"></div>
          </a>
        </div>
        <div class="flag-container">
          <a href="https://weltgesundheit.org/en/" class="text-link">
            <div class="flag en" title="English"></div>
          </a>
        </div>
      </div>
      <p>Illustration: Alice Ruzzettu</p>
      <a href="http://plan-g.at/impressum" class="text-link" target="_blank">Imprint</a>
    </div>
  </body>
</html>
